import React, { useEffect, useState, useCallback } from 'react';
import client from './client';
import Modal from './Components/Modal';
const useTwitter = (props) => {
    const [visible, setVisible] = useState(false);
    const [authURL, setAuthURL] = useState('');
    const [webViewState, setWebViewState] = useState(null);
    const [loggedIn, setLoggedIn] = useState(false);
    const login = async (callback_url) => {
        const url = await client.getLoginUrl(callback_url);
        setAuthURL(url);
        setVisible(true);
    };
    const TWModal = useCallback((modalProps) => {
        const onWebViewStateChanged = (webViewNavigation) => {
            setWebViewState(webViewNavigation);
        };
        return (<Modal visible={visible} authURL={authURL} onClosePress={() => setVisible(false)} onWebViewStateChanged={onWebViewStateChanged} incognito={modalProps.incognito} headerColor={modalProps.headerColor} closeText={modalProps.closeText} renderHeader={modalProps.renderHeader}/>);
    }, [visible]);
    useEffect(() => {
        if (webViewState) {
            const match = webViewState.url.match(/\?oauth_token=.+&oauth_verifier=(.+)/);
            if (match && match.length > 0) {
                setVisible(false);
                setAuthURL('');
                client.getAccessToken(match[1]).then((response) => {
                    client.setAccessToken(response.oauth_token, response.oauth_token_secret);
                    setLoggedIn(true);
                }).catch((err) => {
                    console.warn(`[getAccessToken failed] ${err}`);
                    if (props?.onError) {
                        props.onError(err);
                    }
                });
            }
        }
    }, [webViewState]);
    useEffect(() => {
        if (loggedIn && props?.onSuccess) {
            const options = {
                include_entities: false,
                skip_status: true,
                include_email: true,
            };
            client.api('GET', 'account/verify_credentials.json', options).then((response) => {
                props.onSuccess(response, { oauth_token: client.Token, oauth_token_secret: client.TokenSecret });
                setLoggedIn(false);
            }).catch((err) => {
                console.warn(`[get("account/verify_credentials.json") failed] ${err}`);
                if (props?.onError) {
                    props.onError(err);
                }
                setLoggedIn(false);
            });
        }
    }, [loggedIn]);
    return {
        twitter: {
            login,
            getAccessToken: () => ({ oauth_token: client.Token, oauth_token_secret: client.TokenSecret }),
            setAccessToken: client.setAccessToken,
            setConsumerKey: client.setConsumerKey,
            api: client.api,
            post: client.post,
            get: client.get,
        },
        TWModal,
    };
};
export default useTwitter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9va3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaG9va3MudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFNaEUsT0FBTyxNQUFNLE1BQU0sVUFBVSxDQUFDO0FBRTlCLE9BQU8sS0FBOEIsTUFBTSxvQkFBb0IsQ0FBQztBQU9oRSxNQUFNLFVBQVUsR0FBRyxDQUFDLEtBQWEsRUFBRSxFQUFFO0lBQ25DLE1BQU0sQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLEdBQUcsUUFBUSxDQUFVLEtBQUssQ0FBQyxDQUFDO0lBQ3ZELE1BQU0sQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLEdBQUcsUUFBUSxDQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQ25ELE1BQU0sQ0FBQyxZQUFZLEVBQUUsZUFBZSxDQUFDLEdBQUcsUUFBUSxDQUEyQixJQUFJLENBQUMsQ0FBQztJQUNqRixNQUFNLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxHQUFHLFFBQVEsQ0FBVSxLQUFLLENBQUMsQ0FBQztJQUV6RCxNQUFNLEtBQUssR0FBRyxLQUFLLEVBQUUsWUFBcUIsRUFBRSxFQUFFO1FBQzVDLE1BQU0sR0FBRyxHQUFXLE1BQU0sTUFBTSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUUzRCxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEIsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25CLENBQUMsQ0FBQztJQUVGLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxDQUFDLFVBQXNCLEVBQUUsRUFBRTtRQUNyRCxNQUFNLHFCQUFxQixHQUFHLENBQUMsaUJBQW9DLEVBQUUsRUFBRTtZQUNyRSxlQUFlLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUM7UUFFRixPQUFPLENBQ0wsQ0FBQyxLQUFLLENB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QUMsQ0FBQyxFQUFFLFdBQVcsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMxRyxjQUFjLEVBQUUsTUFBTSxDQUFDLGNBQWM7WUFDckMsY0FBYyxFQUFFLE1BQU0sQ0FBQyxjQUFjO1lBQ3JDLEdBQUcsRUFBRSxNQUFNLENBQUMsR0FBRztZQUNmLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSTtZQUNqQixHQUFHLEVBQUUsTUFBTSxDQUFDLEdBQUc7U0FDaEI7UUFDRCxPQUFPO0tBQ1IsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGVBQWUsVUFBVSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuXG4vKiBub2RlX21vZHVsZXMgKi9cbmltcG9ydCB7IFdlYlZpZXdOYXZpZ2F0aW9uIH0gZnJvbSAncmVhY3QtbmF0aXZlLXdlYnZpZXcnO1xuXG4vKiBjbGllbnQgKi9cbmltcG9ydCBjbGllbnQgZnJvbSAnLi9jbGllbnQnO1xuaW1wb3J0IHsgRXJyb3JSZXNwb25zZSwgQWNjZXNzVG9rZW4sIFR3aXR0ZXJVc2VyIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgTW9kYWwsIHsgUHJvcHMgYXMgTW9kYWxQcm9wcyB9IGZyb20gJy4vQ29tcG9uZW50cy9Nb2RhbCc7XG5cbnR5cGUgUHJvcHMgPSB7XG4gIG9uU3VjY2VzczogKHVzZXI6IFR3aXR0ZXJVc2VyLCBhY2Nlc3NUb2tlbjogQWNjZXNzVG9rZW4pID0+IHZvaWQsXG4gIG9uRXJyb3I/OiAoZXJyOiBFcnJvclJlc3BvbnNlKSA9PiB2b2lkLFxufVxuXG5jb25zdCB1c2VUd2l0dGVyID0gKHByb3BzPzogUHJvcHMpID0+IHtcbiAgY29uc3QgW3Zpc2libGUsIHNldFZpc2libGVdID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpO1xuICBjb25zdCBbYXV0aFVSTCwgc2V0QXV0aFVSTF0gPSB1c2VTdGF0ZTxzdHJpbmc+KCcnKTtcbiAgY29uc3QgW3dlYlZpZXdTdGF0ZSwgc2V0V2ViVmlld1N0YXRlXSA9IHVzZVN0YXRlPFdlYlZpZXdOYXZpZ2F0aW9uIHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtsb2dnZWRJbiwgc2V0TG9nZ2VkSW5dID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIGNvbnN0IGxvZ2luID0gYXN5bmMgKGNhbGxiYWNrX3VybD86IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IHVybDogc3RyaW5nID0gYXdhaXQgY2xpZW50LmdldExvZ2luVXJsKGNhbGxiYWNrX3VybCk7XG5cbiAgICBzZXRBdXRoVVJMKHVybCk7XG4gICAgc2V0VmlzaWJsZSh0cnVlKTtcbiAgfTtcblxuICBjb25zdCBUV01vZGFsID0gdXNlQ2FsbGJhY2soKG1vZGFsUHJvcHM6IE1vZGFsUHJvcHMpID0+IHtcbiAgICBjb25zdCBvbldlYlZpZXdTdGF0ZUNoYW5nZWQgPSAod2ViVmlld05hdmlnYXRpb246IFdlYlZpZXdOYXZpZ2F0aW9uKSA9PiB7XG4gICAgICBzZXRXZWJWaWV3U3RhdGUod2ViVmlld05hdmlnYXRpb24pO1xuICAgIH07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPE1vZGFsXG4gICAgICAgIHZpc2libGU9e3Zpc2libGV9XG4gICAgICAgIGF1dGhVUkw9e2F1dGhVUkx9XG4gICAgICAgIG9uQ2xvc2VQcmVzcz17KCkgPT4gc2V0VmlzaWJsZShmYWxzZSl9XG4gICAgICAgIG9uV2ViVmlld1N0YXRlQ2hhbmdlZD17b25XZWJWaWV3U3RhdGVDaGFuZ2VkfVxuICAgICAgICBpbmNvZ25pdG89e21vZGFsUHJvcHMuaW5jb2duaXRvfVxuICAgICAgICBoZWFkZXJDb2xvcj17bW9kYWxQcm9wcy5oZWFkZXJDb2xvcn1cbiAgICAgICAgY2xvc2VUZXh0PXttb2RhbFByb3BzLmNsb3NlVGV4dH1cbiAgICAgICAgcmVuZGVySGVhZGVyPXttb2RhbFByb3BzLnJlbmRlckhlYWRlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfSwgW3Zpc2libGVdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICh3ZWJWaWV3U3RhdGUpIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gd2ViVmlld1N0YXRlLnVybC5tYXRjaCgvXFw/b2F1dGhfdG9rZW49Lismb2F1dGhfdmVyaWZpZXI9KC4rKS8pO1xuXG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2gubGVuZ3RoID4gMCkge1xuICAgICAgICBzZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgc2V0QXV0aFVSTCgnJyk7XG5cbiAgICAgICAgY2xpZW50LmdldEFjY2Vzc1Rva2VuKG1hdGNoWzFdKS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIGNsaWVudC5zZXRBY2Nlc3NUb2tlbihyZXNwb25zZS5vYXV0aF90b2tlbiwgcmVzcG9uc2Uub2F1dGhfdG9rZW5fc2VjcmV0KTtcblxuICAgICAgICAgIHNldExvZ2dlZEluKHRydWUpO1xuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBbZ2V0QWNjZXNzVG9rZW4gZmFpbGVkXSAke2Vycn1gKTtcblxuICAgICAgICAgIGlmIChwcm9wcz8ub25FcnJvcikge1xuICAgICAgICAgICAgcHJvcHMub25FcnJvcihlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LCBbd2ViVmlld1N0YXRlXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAobG9nZ2VkSW4gJiYgcHJvcHM/Lm9uU3VjY2Vzcykge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgaW5jbHVkZV9lbnRpdGllczogZmFsc2UsXG4gICAgICAgIHNraXBfc3RhdHVzOiB0cnVlLFxuICAgICAgICBpbmNsdWRlX2VtYWlsOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY2xpZW50LmFwaTxUd2l0dGVyVXNlcj4oJ0dFVCcsICdhY2NvdW50L3ZlcmlmeV9jcmVkZW50aWFscy5qc29uJywgb3B0aW9ucykudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgcHJvcHMub25TdWNjZXNzKHJlc3BvbnNlLCB7IG9hdXRoX3Rva2VuOiBjbGllbnQuVG9rZW4sIG9hdXRoX3Rva2VuX3NlY3JldDogY2xpZW50LlRva2VuU2VjcmV0IH0pO1xuXG4gICAgICAgIHNldExvZ2dlZEluKGZhbHNlKTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbZ2V0KFwiYWNjb3VudC92ZXJpZnlfY3JlZGVudGlhbHMuanNvblwiKSBmYWlsZWRdICR7ZXJyfWApO1xuXG4gICAgICAgIGlmIChwcm9wcz8ub25FcnJvcikge1xuICAgICAgICAgIHByb3BzLm9uRXJyb3IoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNldExvZ2dlZEluKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwgW2xvZ2dlZEluXSk7XG5cbiAgcmV0dXJuIHtcbiAgICB0d2l0dGVyOiB7XG4gICAgICBsb2dpbixcbiAgICAgIGdldEFjY2Vzc1Rva2VuOiAoKTogQWNjZXNzVG9rZW4gPT4gKHsgb2F1dGhfdG9rZW46IGNsaWVudC5Ub2tlbiwgb2F1dGhfdG9rZW5fc2VjcmV0OiBjbGllbnQuVG9rZW5TZWNyZXQgfSksXG4gICAgICBzZXRBY2Nlc3NUb2tlbjogY2xpZW50LnNldEFjY2Vzc1Rva2VuLFxuICAgICAgc2V0Q29uc3VtZXJLZXk6IGNsaWVudC5zZXRDb25zdW1lcktleSxcbiAgICAgIGFwaTogY2xpZW50LmFwaSxcbiAgICAgIHBvc3Q6IGNsaWVudC5wb3N0LFxuICAgICAgZ2V0OiBjbGllbnQuZ2V0LFxuICAgIH0sXG4gICAgVFdNb2RhbCxcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHVzZVR3aXR0ZXI7XG4iXX0=